---
import emojiRegex from 'emoji-regex'
import { Image } from '@astrojs/image/components'
import { cx } from '@/lib/utils'
import type { Props } from '@astrojs/image/components/Image.astro'

const { src, draggable = 'false', format = 'webp', ...props } = Astro.props as Props
const EmojiRegex = emojiRegex()
---

{
  EmojiRegex.test(props.alt) ? (
    // Twemoji
    <img src={src} draggable={draggable} loading='lazy' decoding='async' {...props} />
  ) : !src?.width || !src?.height ? (
    // Remote image
    <img
      src={src}
      draggable={draggable}
      loading='lazy'
      decoding='async'
      class={cx('mx-auto w-full rounded-md', props.class)}
      {...props}
    />
  ) : (
    // Local image
    <Image
      {src}
      draggable={draggable}
      format={format}
      class={cx('mx-auto w-full rounded-md', props.class)}
      {...props}
    />
  )
}
