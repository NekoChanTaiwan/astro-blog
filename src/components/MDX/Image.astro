---
import emojiRegex from 'emoji-regex'
import { Image } from '@astrojs/image/components'
import { cx } from '@/lib/utils'
import type { Props } from '@astrojs/image/components/Image.astro'

const {
  src,
  draggable = 'false',
  loading = 'lazy',
  decoding = 'async',
  format = 'webp',
  ...props
} = Astro.props as Props

const EmojiRegex = emojiRegex()
---

{
  EmojiRegex.test(props.alt) ? (
    // Twemoji
    <img src={src} draggable={draggable} loading={loading} decoding={decoding} {...props} />
  ) : !src?.width || !src?.height ? (
    // Remote image
    <img
      src={src}
      draggable={draggable}
      loading={loading}
      decoding={decoding}
      class={cx('mx-auto w-full rounded-md', props.class)}
      {...props}
    />
  ) : (
    // Local image
    <Image
      {src}
      draggable={draggable}
      format={format}
      loading={loading}
      decoding={decoding}
      class={cx('mx-auto w-full rounded-md', props.class)}
      {...props}
    />
  )
}
